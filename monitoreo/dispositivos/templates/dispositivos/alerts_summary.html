{% extends "dispositivos/base.html" %}

{% block title %}Panel de Alertas{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Resumen de alertas</h2>

  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <label for="severity" class="form-label">Severidad</label>
      <select id="severity" name="severity" class="form-select">
        <option value="">Todas</option>
        <option value="grave">Grave</option>
        <option value="alta">Alta</option>
        <option value="media">Media</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="from" class="form-label">Desde</label>
      <input type="date" id="from" name="from" class="form-control">
    </div>
    <div class="col-md-3">
      <label for="to" class="form-label">Hasta</label>
      <input type="date" id="to" name="to" class="form-control">
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button type="submit" class="btn btn-primary w-100">Filtrar alertas</button>
    </div>
  </form>

  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card text-white bg-success mb-3">
        <div class="card-body">
          <h5 class="card-title">Revisadas</h5>
          <p class="card-text fs-3">{{ reviewed_count }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card text-white bg-danger mb-3">
        <div class="card-body">
          <h5 class="card-title">Pendientes</h5>
          <p class="card-text fs-3">{{ pending_count }}</p>
        </div>
      </div>
    </div>
  </div>

  <h4 class="mb-3">Alertas por severidad</h4>
  {% if severity_counts %}
    <ul class="list-group mb-4">
      {% for item in severity_counts %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ item.status|title }}
          <span class="badge bg-secondary rounded-pill">{{ item.count }}</span>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">No hay alertas registradas.</p>
  {% endif %}

  <h4 class="mb-3">Últimas alertas</h4>
  {% if recent_alerts %}
    <div class="list-group">
      {% for alert in recent_alerts %}
        <div class="list-group-item">
          <strong>{{ alert.device.name }}</strong> — {{ alert.timestamp|date:"d/m/Y H:i" }}<br>
          <span class="text-danger">{{ alert.message }}</span><br>
          {% if alert.reviewed %}
            <span class="badge bg-success">Revisada</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pendiente</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No se han generado alertas recientemente.</p>
  {% endif %}
</div>
{% endblock %}